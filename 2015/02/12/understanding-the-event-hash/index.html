<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>A deep dive into Backbone.View events | Marionette.js Blog</title>
  <meta name="description" content="Detailed analysis showing usage of Marionette features within real-world applications" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/manifest.json">
  <meta name="msapplication-TileColor" content="#b91d47">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" type="text/css" href="../../../../css/screen.css" />
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Questrial" />

  <meta name="generator" content="Marionette.js Blog">

  
  
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="atom.xml">
  
  

  
</head>


<body class="post-template">

  

<main class="content" role="main">
  <article class="post">
    <header class="post-header">
      <a class="blog-logo" href="../../../../index.html">
        
        <img src="http://marionettejs.com/images/marionette.svg" alt="Blog Logo"/></a>
        
      </a>
    </header>
    <span class="post-meta">
      <time datetime="2015-02-12T19:19:00.000Z" itemprop="datePublished">Feb 12 2015</time>
       in<a href='../../../../tags/backbone/index.html' style='margin:0 5px;'>backbone</a><a href='../../../../tags/learning/index.html' style='margin:0 5px;'>learning</a><a href='../../../../tags/question/index.html' style='margin:0 5px;'>question</a>
    </span>
    <h1 class="post-title">A deep dive into Backbone.View events</h1>
    <section class="post-content">
      <p>Backbone Views have a handy declarative events API. That lets you abstract your DOM event bindings into a declarative hash on your views prototype. For example</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Backbone.View.extend(&#123;</div><div class="line">  <span class="attr">template</span>: _.template(<span class="string">"&lt;p&gt;click me &lt;/p&gt;"</span>),</div><div class="line">  <span class="attr">events</span>: &#123;</div><div class="line">    <span class="string">"click p"</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="built_in">console</span>.log(<span class="string">"clicked"</span>)&#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>After your view is created and rendered, anytime a user clicks on the <code>p</code> tag there will be a nice alert message in the console.</p>
<p>How does this work though? Let’s dive in and investigate.</p>
<p>Before we go into the exact details, let’s step through the path of setting up event handlers on DOM nodes to round out our perspective.</p>
<p>In the early days of html (V3.2) or so <a href="http://www.w3.org/TR/WD-script-960208.html" target="_blank" rel="external">w3-spec</a><br>there was a call to allow users to harness a set of “intrinsic events that are generated by objects associated with HTML elements”, <code>onClick</code> happens to be one of those. With that said, why don’t we turn back the clock and set up an “intrinsic” event?</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">onclick</span>=<span class="string">"alert('wow such inline')"</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Most people can agree nowadays that we want some degree of separation between our markup language and event bindings*, allowing a level of declarative control at a scripting level.</p>
<p>In comes the mythical JavaScript beast.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> im just a p tag sitting in a body <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="built_in">document</span>.querySelector(<span class="string">'p'</span>).addEventListener(<span class="string">'click'</span>, ()=&gt; alert(<span class="string">'hi mom'</span>), <span class="literal">false</span>)</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>addEventListener</code> gives you the ability to register arbitrary event listeners on the event target, opening the door for dynamic event registration and essentially giving you the power to set up a reactive DOM tree depending on a user’s actions.</p>
<p>From there we waddle up the evolutionary tree into jQuery, and into the beauty of <code>$.on</code>. At this point we can get back to the question initially proposed. How does the Backbone event hash really work?</p>
<p>Looking at the source for Backbone’s View class we see a call to <a href="https://github.com/jashkenas/backbone/blob/1.1.0/backbone.js#L992" target="_blank" rel="external"><code>delegateEvents</code></a> within our view constructor</p>
<p>Let’s step through this method line by line to really understand every single thing that it is doing.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">delegateEvents: <span class="function"><span class="keyword">function</span>(<span class="params">events</span>) </span>&#123;</div><div class="line">  <span class="comment">// If we have no events NOOP and exit the method.</span></div><div class="line">  <span class="comment">// (this is sometimes called a GuardClause or Precondition*)</span></div><div class="line">  <span class="keyword">if</span> (!(events || (events = _.result(<span class="keyword">this</span>, <span class="string">'events'</span>)))) <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">  <span class="comment">// unset any event handlers that might</span></div><div class="line">  <span class="comment">// already be in place</span></div><div class="line">  <span class="keyword">this</span>.undelegateEvents();</div><div class="line">  <span class="comment">// Now we are going to loop over every key value pair</span></div><div class="line">  <span class="comment">// in the events hash. For this case lets assume the events hash</span></div><div class="line">  <span class="comment">// contains a single key value pair</span></div><div class="line">  <span class="comment">// of &#123;"click p": function()&#123;alert('hi')&#125;&#125;</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> events) &#123;</div><div class="line">    <span class="comment">// Since we only have the key value of the</span></div><div class="line">    <span class="comment">// hash ("click p") in this case</span></div><div class="line">    <span class="comment">// we need to get the value out of the events hash.</span></div><div class="line">    <span class="keyword">var</span> method = events[key];</div><div class="line">    <span class="comment">// Backbone allows you to pass in a string based value</span></div><div class="line">    <span class="comment">// that it will look up</span></div><div class="line">    <span class="comment">// on the view instance. In our case we do not have to work</span></div><div class="line">    <span class="comment">// about this line</span></div><div class="line">    <span class="keyword">if</span> (!_.isFunction(method)) method = <span class="keyword">this</span>[events[key]];</div><div class="line">    <span class="comment">// If there is no value, or the value evaluated to a</span></div><div class="line">    <span class="comment">// falsey value kick out of this</span></div><div class="line">    <span class="comment">// iteration of the loop. (This is a micro optimization)</span></div><div class="line">    <span class="keyword">if</span> (!method) <span class="keyword">continue</span>;</div><div class="line">    <span class="comment">// The match here is going to take care of splitting the</span></div><div class="line">    <span class="comment">// DOM node selector from the</span></div><div class="line">    <span class="comment">// event that we will be registering on the DOM node.</span></div><div class="line">    <span class="keyword">var</span> match = key.match(delegateEventSplitter);</div><div class="line">    <span class="comment">// In our case eventName will be click and selector will be 'p'</span></div><div class="line">    <span class="keyword">var</span> eventName = match[<span class="number">1</span>], selector = match[<span class="number">2</span>];</div><div class="line">    <span class="comment">// The next step is to ensure that the `this`</span></div><div class="line">    <span class="comment">// context of the event handler will be</span></div><div class="line">    <span class="comment">// our view as compared to the default `this` context</span></div><div class="line">    <span class="comment">// of a event registration which would be the</span></div><div class="line">    <span class="comment">// DOM node that event was registered on</span></div><div class="line">    <span class="comment">// (the p tag in our case).</span></div><div class="line">    method = _.bind(method, <span class="keyword">this</span>);</div><div class="line">    <span class="comment">// This line can be a bit confusing initially,</span></div><div class="line">    <span class="comment">// however it is a very powerful one. This is taking your event</span></div><div class="line">    <span class="comment">// name that you want to register for</span></div><div class="line">    <span class="comment">// (click in our case) and setting up</span></div><div class="line">    <span class="comment">// a jquery event namespace*, significantly</span></div><div class="line">    <span class="comment">// simplifying how to unregister</span></div><div class="line">    <span class="comment">// all events on this given view instance.</span></div><div class="line">    eventName += <span class="string">'.delegateEvents'</span> + <span class="keyword">this</span>.cid;</div><div class="line">    <span class="comment">// At this point eventName will be something</span></div><div class="line">    <span class="comment">// like "click.delegateEventsc1"</span></div><div class="line">    <span class="keyword">if</span> (selector === <span class="string">''</span>) &#123;</div><div class="line">      <span class="comment">// If we do not have a selector we set the event listener on</span></div><div class="line">      <span class="comment">// the root `el` node of out view.</span></div><div class="line">      <span class="keyword">this</span>.$el.on(eventName, method);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="comment">// If there is a selector however we use the</span></div><div class="line">      <span class="comment">// 3 argument signature of jquery's `on`.</span></div><div class="line">      <span class="keyword">this</span>.$el.on(eventName, selector, method);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>After that look into how <code>delegateEvents</code> works you may be thinking OK great now I know how it works. However I will challenge your understanding with a follow up. If you noticed that we call <code>delegateEvents</code> in the view’s constructor, before we have ever called render.<br>So … We just registered a click handler on a <code>p</code> tag that does not exist. <code>addEventListener</code> would not work, so how does <code>on</code> work before we have even rendered? Good question right?</p>
<p>Taking a look at the jquery docs reveals the answer to our puzzling question. In comes <strong>Direct</strong> and in our case <strong>delegated events</strong>.<br><a href="http://api.jquery.com/on/#direct-and-delegated-events" target="_blank" rel="external">Docs</a></p>
<blockquote>
<p>Delegated events have the advantage that they can process events from descendant elements that are added to the document at a later time. By picking an element that is guaranteed to be present at the time the delegated event handler is attached, you can use delegated events to avoid the need to frequently attach and remove event handlers</p>
</blockquote>
<p>Meaning, since we know we have our root <code>el</code> from Backbone that will eventually contain our template, we can use this feature of jQuery to take care of the deferred event registration for us.</p>
<p>In summary, the Backbone event hash does quite a bit more than simple registration of key value pairs. It abstracts a fairly complex set of concerns into a easy-to-decipher declarative API.</p>
<p>I hope you learned something, I know I did.<br>Thanks to <a href="https://github.com/Seebiscuit" target="_blank" rel="external">Seebiscuit</a> for asking this great question<br>in the <a href="https://gitter.im/marionettejs/backbone.marionette?utm_source=share-link&amp;utm_medium=link&amp;utm_campaign=share-link" target="_blank" rel="external">Marionette Chatroom</a>.</p>
<p>Sam Saccone<br><a href="http://twitter.com/samccone" target="_blank" rel="external">@samccone</a></p>
<hr>
<p>[1] - Angular has <code>ng-click</code>, and React has <code>onClick</code>. There is a nice argument around coupling the event bindings to your template, but for this article that is not a battle I want to fight. :)<br>[2] - <a href="http://c2.com/cgi/wiki?GuardClause" target="_blank" rel="external">http://c2.com/cgi/wiki?GuardClause</a><br>[3] - <a href="http://api.jquery.com/on/#event-names" target="_blank" rel="external">http://api.jquery.com/on/#event-names</a> <a href="http://api.jquery.com/event.namespace/" target="_blank" rel="external">http://api.jquery.com/event.namespace/</a></p>

    </section>
      <div id="disqus_thread"></div>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      <footer class="post-footer">
      <section class="share">
        <h4>Share this post</h4>
        <a class="icon-twitter" href="http://twitter.com/share?url=http://marionettejs.github.io/2015/02/12/understanding-the-event-hash/"
          onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <span class="hidden">Twitter</span>
        </a>
        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://marionettejs.github.io/2015/02/12/understanding-the-event-hash/"
          onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <span class="hidden">Facebook</span>
        </a>
        <a class="icon-google-plus" href="https://plus.google.com/share?url=http://marionettejs.github.io/2015/02/12/understanding-the-event-hash/"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
          <span class="hidden">Google+</span>
        </a>
      </section>
    </footer>
  </article>
</main>


  
<footer class="site-footer">
  
  <a class="subscribe icon-feed" href="../../../../atom.xml"><span class="tooltip">Subscribe!</span></a>
  
  <div class="inner">
     <p>Made with
       <span class="heart-icon">&hearts;</span>by&nbsp;
       <a href="https://github.com/marionettejs/marionettejs.com/graphs/contributors" target="_blank">all of us</a>
     </p>
  </div>
</footer>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="../../../../js/jquery.fitvids.js"></script>
<script type="text/javascript" src="../../../../js/index.js"></script>


<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52727533-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>


<script type="text/javascript">
    var disqus_shortname = 'marionette';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




</body>
</html>
